
# Nacional
```{r national}
x <- "Nacional"

cat(paste("## Resumen Actual de Casos en México \n \n"))
ktbl <- tbl.pais[[x]] %>% 
          knitr::kable(format = "html",
                   digits = 0,
                   row.names = F,
                   align = "c") %>%
          kableExtra::kable_styling(
                  bootstrap_options = c("striped","condensed"),
                  full_width = F) 
  print(ktbl)

cat("\n\n")  


cat(paste("## Gráfica de Nuevos Casos por Día \n\n"))
cat("Los casos positivos y pendientes son contabilizados respecto a la fecha de ingreso. Los decesos son contabilizados respecta a la fecha de fallecimiento. En cuantos a los casos positivos, ten en cuenta que los días más recientes añadirán aquellos casos pendientes que sean determinados positivos una vez que el resultado de la prueba esté disponible. \n\n")
htmltools::tagList( ggplotly(plot.casesnew[[x]], tooltip = "text",
                             dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v",
                                             x = 0)) )

cat("\n\n")

cat(paste("## Gráfica de Acumulado de Casos \n\n"))
cat("Los casos positivos y pendientes son contabilizados respecto a la fecha de ingreso. Los decesos son contabilizados respecta a la fecha de fallecimiento. En cuantos a los casos positivos, ten en cuenta que los días más recientes añadirán aquellos casos pendientes que sean determinados positivos una vez que el resultado de la prueba esté disponible. \n\n")
htmltools::tagList( ggplotly(plot.casestotal[[x]], tooltip = "text",
                             dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v",
                                             x = 0)) )

cat("\n\n")

cat(paste("## Gráfica de Casos Positivos por Edad/Sexo \n\n"))
cat("\n\n")
htmltools::tagList( ggplotly(plot.possex[[x]], tooltip = "text",
                             dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v", x = 0)) )

cat("\n\n")

cat(paste("## Gráfica de Decesos por Enfermedad/Edad \n\n"))
cat("\n\n")
htmltools::tagList( ggplotly(plot.condicion[[x]], tooltip = "text") %>%
                      layout(height = 400))

cat("\n\n")

cat(paste("## Gráfica de Casos/Pruebas por Día  \n\n"))
cat("\n\n")
htmltools::tagList( ggplotly(plot.pruebasnew[[x]], tooltip = "text",
                             dynamicTicks = TRUE) )

cat("\n\n")

cat(paste("## Gráfica de Tasa Positividad y Letalidad \n\n"))
cat("\n\n")
htmltools::tagList( ggplotly(plot.tasatotal[[x]], tooltip = "text",
                             dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v",
                                             x = 0)) )

cat("\n\n")

cat(paste("## Casos por Entidad de Residencia \n \n"))
ktbl <- tbl.entidades[[x]] %>% 
          knitr::kable(format = "html",
                   digits = 0,
                   row.names = F,
                   align = "c") %>%
          kableExtra::kable_styling(
                  bootstrap_options = c("striped","condensed"),
                  full_width = F) %>%
          kableExtra::scroll_box(height = "260px")
  print(ktbl)

cat("\n\n")  

cat(paste("## Gráfica por Institución que Brindó la Atención \n\n"))
cat("\n\n")
htmltools::tagList( ggplotly(plot.sector[[x]], tooltip = "text",
                             dynamicTicks = TRUE) )

cat("\n\n")

```

```{r state}
grp_names_state <- grp_names[grp_names != "Nacional"]
for(x in grp_names_state){
  
  cat(paste("#", x, sep = " ", "\n\n"))

  cat(paste("## Resumen Actual de Casos \n\n", sep = " "))
  ktbl <- tbl.entidades[["Nacional"]] %>% 
              filter(`Entidad Residencia` == x) %>%
              select(-c(`Entidad Residencia`)) %>%
          knitr::kable(format = "html",
                   digits = 0,
                   row.names = F,
                   align = "c") %>%
          kableExtra::kable_styling(
                  bootstrap_options = c("striped","condensed"),
                  full_width = F)
    print(ktbl)

cat("\n\n")    
  cat("## Gráfica de Nuevos Casos por Día \n\n")
  cat("Los casos positivos y pendientes son contabilizados respecto a la fecha de ingreso. Los decesos son contabilizados respecta a la fecha de fallecimiento. En cuantos a los casos positivos, ten en cuenta que los días más recientes añadirán aquellos casos pendientes que sean determinados positivos una vez que el resultado de la prueba esté disponible. \n\n")

  print(htmltools::tagList( ggplotly(plot.casesnew[[x]], tooltip = "text",
                                     dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v", x = 0)) ))
  
  cat("## Gráfica de Acumulado de Casos \n\n")
  cat("Los casos positivos y pendientes son contabilizados respecto a la fecha de ingreso. Los decesos son contabilizados respecta a la fecha de fallecimiento. En cuantos a los casos positivos, ten en cuenta que los días más recientes añadirán aquellos casos pendientes que sean determinados positivos una vez que el resultado de la prueba esté disponible. \n\n")
  print(htmltools::tagList( ggplotly(plot.casestotal[[x]], tooltip = "text",
                                     dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v", x = 0)) ))
  
  cat(paste("## Gráfica de Casos Positivos por Edad/Sexo \n\n"))
  cat("\n\n")
  print(htmltools::tagList( ggplotly(plot.possex[[x]], tooltip = "text",
                             dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v", x = 0)) ))
  
  cat(paste("## Gráfica de Decesos por Enfermedad/Edad \n\n"))
  cat("\n\n")
  if(x != "Colima"){
  print(htmltools::tagList( ggplotly(plot.condicion[[x]], tooltip = "text") %>%
                      layout(height = 400)))}
  else{cat("No hay decesos confirmados a la fecha. \n\n")}
  
  cat(paste("## Gráfica de Casos/Pruebas por Día  \n\n"))
  cat("\n\n")
  print(htmltools::tagList( ggplotly(plot.pruebasnew[[x]], tooltip = "text",
                             dynamicTicks = TRUE) ) )
  
  cat("## Gráfica de Tasa Positividad y Letalidad \n\n")
  cat(" \n\n")
  print(htmltools::tagList( ggplotly(plot.tasatotal[[x]], tooltip = "text",
                                     dynamicTicks = TRUE) %>%
                        layout(legend = list(orientation = "v", x = 0)) )) 
  
  cat(paste("## Casos por Municipio de Residencia \n \n"))
  ktbl <- tbl.municipios[[x]] %>% 
    knitr::kable(format = "html",
                  digits = 0,
                 row.names = F,
                 align = "c") %>%
    kableExtra::kable_styling(
          bootstrap_options = c("striped","condensed"),
          full_width = F) %>%
    kableExtra::scroll_box(height = "260px")
  print(ktbl)
  
  cat(paste("## Gráfica por Institución que Brindó la Atención \n\n"))
  cat("\n\n")
  print(htmltools::tagList( ggplotly(plot.sector[[x]], tooltip = "text",
                             dynamicTicks = TRUE) ))
  
  cat("\n\n")
}
```


